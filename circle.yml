machine:
    environment:
        LISP: sbcl-bin
        PATH: ~/.roswell/bin:$PATH
        CXX: clang++

dependencies:
    cache_directories:
        - ~/.roswell/
        - ~/pocl-0.12/

    pre:
        - sudo apt-get install -y pkg-config libltdl3-dev libhwloc-dev llvm-dev clang libclang-dev ocl-icd-opencl-dev libedit-dev
        - if [ ! -d ~/.roswell/ ]; then curl -L https://raw.githubusercontent.com/snmsts/roswell/master/scripts/install-for-ci.sh | sh; fi
        - if [ ! -d ~/pocl-0.12/ ]; then pushd . && cd && wget http://portablecl.org/downloads/pocl-0.12.tar.gz && popd; fi
        - if [ ! -d ~/pocl-0.12/ ]; then pushd . && cd && tar xzf pocl-0.12.tar.gz && cd pocl-0.12/ && ./configure && make && sudo make install && popd; fi
        - ros install prove

test:
    override:
        - ros run -- --version
        - run-prove *-test.asd
